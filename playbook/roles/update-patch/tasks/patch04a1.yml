- name: Start Elasticsearch if not started
  service: name=elasticsearch state=started

- name: wait for Elasticsearch to start
  wait_for: port=9200 delay=30

- name: copy few kibana ui related files kibana.bundle
  synchronize: src=roles/reports-conf/templates/kibana_bundle dest={{elk_kibana.path}}/optimize/bundles/kibana.bundle.js

- name: copy elastic dump for kibana charts/dashboards
  synchronize: src={{playbook_dir}}/files/.kibana.tar.gz dest=/var/log/elasticsearch/.kibana.tar.gz

- name: Exexute curl command to copy kibana dump
  shell: 'curl -XPOST localhost:9200/.kibana/_import'

- name: Pull source from Repository for reportsloading
  git: repo={{git_url_reports_loading}}
       dest={{reports_loading_path}}
       version={{git_branch_reports_loading}}
       force=yes
